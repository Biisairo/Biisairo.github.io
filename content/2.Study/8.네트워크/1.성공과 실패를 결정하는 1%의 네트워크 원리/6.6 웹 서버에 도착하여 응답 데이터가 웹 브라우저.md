# 6. 웹 서버에 도착하여 응답 데이터가 웹 브라우저로 돌아간다

## 1. 서버의 개요

### 1. 클라이언트와 서버의 차이점

### 2. 서버 애플리케이션의 구조

- 서버는 동식에 복수의 클라이언트와 통신을 하기때문에 하나의 프로그램으로 모든 클라이언트들을 상대하기 어려움
- 클라이언트가 접속할 때 마다 새로 서버 프로그램을 작동하여 서버 애플리케이션과 1대 1로 대화하는 방법을 사용함
- 클라이언트의 접속을 기다리는 부분과 실제 클라이언트와 대화를 하는 부분을 나눔
    - 접속을 기다리는 부분은 서버의 시작과 동시에 준비가 되어 클라이언트의 접속을 기다림
    - 클라이언트가 접속하면 클라이언트와 대화를 하는 프로세스를 새로 만들게 되며 소켓의 연결을 해당 프로세스로 넘김
    - 클라이언트는 새로 생긴 프로세스와 대화를 하게 됨
- 서버에서는 멀티태스크, 멀티스레딩을 사용해 다수의 프로세스를 동시에 돌리며 다수의 클라이언트와 대화를 할 수 있게 됨

### 3. 서버측의 소켓과 포트 번호

- 클라이언트
    - 접속을 시도하는 쪽
    - 접속 순서
        - 소켓 생성
        - 접속
        - 송수신
        - 연결 끊기
- 서버
    - 접속을 기다리는 쪽
    - 접속 순서
        - 소켓 생성
        - 접속 대기
        - 접속 접수
        - 송수신
        - 연결 끊기
- 소켓을 생성한 후 bind 함수를 사용해 소켓에 포트 번호를 기록함
    - 클라이언트는 서버에 접속할 때 해당 포트 번호를 사용해 접속
    - http 는 80 번으로 정해져 있음
- 이후 listen 함수를 사용해 클라이언트의 접속을 기다림
- 클라이언트가 접속을 시도하면 accept 함수를 사용해 클라이언트의 접속을 접수
- accept 가 끝나면 접속이 완료된 상태 이므로 클라이언트와 대화하는 프로세스를 생성

## 2. 서버의 수신 동작

## 3. 웹 서버 소프트웨어가 리퀘스트 메시지의 의미를 해석하여 요구에 응한다

### 1. 조회의 URI 를 실제 파일명으로 변환한다

- 웹 서버에서 read 를 통해 받은 내용을 파악해 처리를 한 뒤 write 를 통해 반환해주게 됨
- 기본적으로 메소드 뒤의 파일명을 찾아 반환해 주게 됨
- 파일명이 그대로 드러나 있을 경우 웹 서버의 디스크를 그대로 공개하는 것과 같아 가상의 디렉토리를 사용

### 2. CGI 프로그램을 작동하는 경우

- Common Gateway Interface
- URI 의 내용이 문서나 데이터인 경우 해당 데이터를 그대로 반환해 줌
- 프로그램 파일의 이름인 경우 해당 프로그램을 실행시켜 나온 반환값은 반송하게 됨
- 웹 서버가 URI 의 파일명을 판단하여 cgi, php 등의 확장자가 들어오면 해당 프로그램을 실행시키게 됨

### 3. 웹 서버로 수행하는 액세스 제어

- 기본적으로 웹서버는 요청 메시지를 파악하여 데이터를 가공, 획득해 반환해줌
- 사전에 설정한 조건에 따라 해당 동작을 금지하거나 필터링할 수 있음
- 액세스 제어
    - 조건에 따라 액세스 동작 여부를 설정하는 기능
- 주로 웹 서버에서 사용하는 조건
    - 클라이언트의 주소
        - 접속 동작에서 클라이언트의 IP 를 확인
    - 클라이언트의 도메인 이름
        - 접속 동작에서 클라이언트의 IP 를 사용
        - DNS 서버를 이용해 IP 에서 도메인 이름을 확인
    - 사용자명과 패스워드
        - 웹 서버에서 클라이언트에게 사용자명과 패스워드를 요구해 액세스여부를 판단

### 4. 응답 메시지를 되돌려 보낸다

- 만들어진 응답 메시지를 write 함수를 통해 클라이언트에 전송

## 4. 웹 브라우저가 응답 메시지를 받아 화면에 표시한다

### 1. 응답 데이터의 형식을 보고 본질을 판단한다

- 응답 메시지의 헤더에 있는 Content-type 필드를 사용해 응답한 메시지의 형태를 파악함
    - text
        - text/html
        - text/plain
    - image
        - image/jpeg
        - image/gif
    - audio…
    - video…
    - model…
    - application…
    - message…
    - multipart…
    - 등등…
- 이외의 charset, content-encoding 등의 응답의 형태를 나타내는 헤더 필드가 존재

### 2. 브라우저 화면에 웹 페이지를 표시하여 액세스를 완료한다

- 데이터의 종류에 따라 화면에 데이터를 표시