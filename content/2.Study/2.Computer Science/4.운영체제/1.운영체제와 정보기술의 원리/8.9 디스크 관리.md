# 9. 디스크 관리

## 0.

- 디스크
    - 대표적인 컴퓨터의 2차 저장장치
    - 휘발성(volatile) 인 메모리와 다르게 영구적인 저장장치

## 1. 디스크의 구조

- 디스크 외부에서는 디스크를 일정한 크기의 논리 블럭으로 나뉘어진 일차원 배열로 취급하고 사용
- 디스크는 하나 이상의 데이터가 저장되는 마그네틱 원판과 마그네틱 원판에서 데이터를 읽어오는 암(arm)으로 구성됨
- 섹터 (sector)
    - 각 논리 블럭이 저장되는 물리적인 위치
- 트랙 (track)
    - 마그네틱 원판의 구성요서
    - 섹터의 집합
- 실린더 (cylinder)
    - 각 원판에서 상대적 위치가 동일한 트랙들의 집합
- 데이터를 읽기 위해 헤드가 달려있는 암이 해당 섹터가 있는 실린더로 이동한 후 원판이 회전하면서 섹터를 읽게됨

## 2. 디스크 스케줄링

- 디스크 접근시간 (access time)
    - 탐색시간 (seek time)
        - 디스크 헤드를 해당 실린더로 위치시키는데 걸리는 시간
    - 회전 지연시간 (rotational latency)
        - 디스크가 회전해서 탐색하려는 섹터가 헤드에 도달하는 시간
    - 전송시간 (transfer time)
        - 섹터가 헤드위치에 도달 후 데이터를 섹터에서 읽고 쓰는데 소요되는 시간
    - 회전지연시간과 전송시간은 충분히 작고 운영체제에서 통제하기 힘든부분
    - 탐색시간을 줄여 디스크 접근시간을 최소화 한다
    - 디스크 스케줄링 (disk scheduling)
        - 헤드의 움직임을 최소화 하는 작업
        - 여러 섹터들에 대한 입출력요청이 들어왔을 때 어떤 순서로 처리할지를 결정하는 메커니즘
- FCFS (First come first served) 스케줄링
    - 디스크에 먼저 들어온 요청을 먼저 처리하는 방식
    - 거리가 먼 섹터에있는 요청이 연달아 들어왔을때 시간이 오래 걸리게 된다
- SSTF (Shortest seek time first) 스케줄링
    - 현재 에드로부터 가장 시간이 적게 걸리는 요청, 즉 거리가 가장 가까운 요청을 먼저 처리하는 방식
    - 기아현상이 발생할 수 있다
        - 한쪽에서 지속적인 요청이 들어오는 경우 거리가 먼 곳에 있는 섹터를 탐색하는데 시간이 오래 걸린다
- SCAN 알고리즘
    - 해드가 원판의 안쪽과 바깥쪽을 왕복하며 그 경로에 존재하는 모든 요청을 처리하는 방식
    - 실제 어느 위치의 탐색으로 필요로 하든 헤드는 정해진 방향으로 이동하면서 경로상에 있는 요청을 처리한다
- C-SCAN 알고리즘
    - SCAN 알고리즘과 비슷하나 왕복이 아닌 단방향으로 작동하며 요청을 처리하는 방식
    - 헤드가 끝에 도달하면 반대로 이동하며 스캔을 하는 것이 아닌 시작지점으로 돌아가 다시 스캔을 시작한다
    - SCAN 알고리즘보다 헤드의 이동거리는 조금 늘어나나 좀더 균일한 탐색시간을 제공한다
- LOOK, C-LOOK 알고리즘
    - SCAN 알고리즘은 요청의 존재여부와 관계없이 모든 구간을 스캔한다
    - LOOK 알고리즘은 한쪽방향으로 헤드가 이동하다가 해당 방향에서 대기중인 요청이 없으면 헤드의 방향이 반대로 바뀌게 된다
    - C-LOOK 알고리즘은 C-SCAN 과 마찬가지로 헤드가 이동하다가 해당 방향에서 대기중인 요청이 없으면 시작지점으로 돌아가 다시 스캔을 시작한다

## 3. 다중 디스크 환경에서의 스케줄링

- 서비스에서는 다수의 디스크를 동시에 사용하여 중복 저장함으로써 여러디스크에서 동시에 데이터를 서비스 하거나 디스크 고장에 대한 백업을 유지함
- 이런 환경에서는 동일한 데이터를 어떤 디스크에서 탐색할지에 대한 스케줄링이 필요함
- 탐색시간의 관점에서는 디스크 중 탐색 시간이 제일 적은 디스크를 사용
- 거시적인 관점에서는 각각 디스크 별로 부하균형 (load balancing) 을 맞추는것이 중요
    - 디스크를 각각의 독립적인 스케줄링이 아닌 전체적인 스케줄링을 사용해 한쪽으로 데이터 요청이 집중되지 않도록 함
- 비용적인 측면에서는 전력소모를 줄이기 위한 방법을 사용함
    - 사용량이 적을때에는 일부러 한쪽에만 요청을 집중시켜 적은 전력을 사용하게 함

## 4. 디스크의 저전력 관리

- 디스크의 전력소모 기준
    - 활동 (active) 상태
        - 현재 헤드가 데이터를 읽고 쓰고있는 상태
    - 공회전 (idle) 상태
        - 디스크가 회전중이지만 데이터를 읽거나 쓰고있지 않는 상태
    - 준비 (standby) 상태
        - 디스크가 회전하지는 않지만 인터페이스가 활성화된 상태
    - 휴면 (sleep) 상태
        - 디스크가 회전하지 않고 인터페이스도 비활성화 되어있는 상태
- 일반적으로 디스크가 회전하는 활성상태보다 회전하지 않는 비활성상태가 전력소모가 적음
- 하지만 상태가 전환될 때 부가적인 전력 및 시간이 소모됨
    - 후속 요청까지의 시간간격이 일정시간 (break-even time) 이상일때만 회전을 정지시키는 것이 효율적
- 비활성화 기법
    - 시간기반 (timeout based) 기법
        - 일정 시간동안 디스크가 공회전 상태이면 정지
    - 예측기반 (prediction based) 기법
        - 과거 요청을 확인하여 다음 공회전 구간의 길이를 예측해 정지
    - 확률기반 (stochastic based) 기법
        - 디바이스의 상태변경 시간을 확률분포를 이용해 확인
- 디스크 회전속도 조절 기법
    - 멀티미디어의 경우 시간에 따른 순차적인 데이터 접근이 이루어져 주기성과 규칙성이 있음
    - 이를 예측해 회전속도를 조절
- 디스크의 데이터 배치 기법
    - 실제 디스크의 많은 부분이 비어있다는 점을 사용해 헤드 위치에 가까운곳에 복제본을 만들어 응답시간을 줄이고 전력 소모를 낮춤
- 버퍼캐싱 및 사전인출 기법
    - 요청될 데이터를 미리 알거나 예측할 수 있다면 디스크가 활성상태일때 헤드위치로부터 가까운 데이터를 사전인출 (prefetching) 해 디스크의 비활성화 가능성을 높이는 방식
- 쓰기전략을 통한 저전력 디스크 기법
    - 디스크가 비활성화 상태일때는 쓰기를 하지 않고 기다리다가 디스크가 활성화되었을 때 쓰기를 하는 방법