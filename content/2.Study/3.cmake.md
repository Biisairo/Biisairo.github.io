# cmake

[https://runebook.dev/ko/docs/cmake/-index-](https://runebook.dev/ko/docs/cmake/-index-)

makefile 같은 build 방식을 사용하면 platform 마다 다른 makefile 을 만들어야 함

cmake 는 이를 해결하기 위한 도구

## cmake phase

- Configure time (when cmake itself is running)
    - 준비단계
    - build 를 위한 project 생성
        
        ```bash
        Generate a Project Buildsystem
         cmake [<options>] -B <path-to-build> [-S <path-to-source>]
         cmake [<options>] <path-to-source | path-to-existing-build>
        ```
        
- Build time (when the generator such as make or ninja is running to compile/link the projects)
    - 실행파일 생성
    - 옵션으로 **-j** [<jobs>] 를 사용해 멀티코어 프로세싱 가능
    
    ```bash
    Build a Project
     cmake --build <dir> [<options>] [-- <build-tool-options>]
    ```
    
- Install time (when running the INSTALL target generated by CMake)

## syntax

### project

```bash
cmake_minimum_required(VERSION 3.27)
```

- cmake version 명시

```bash
project(project_name)
```

- 프로젝트 설정
- 특정 변수들이 자동으로 설정됨
- 옵션을 넣어 사용하는 언어, 버전 등 명시 가능

### variable

```bash
set(variable_name value1 [value2...])
```

- variable_name 이름의 변수 선언
- 여러개의 값을 넣을 수 있음

### target

```bash
add_excutable(target_name code1 [code2...])
```

- target_name 이름의 실행파일 생성

```bash
add_library(target_name code1 [code2...])
```

- target_name 이름의 library 파일 생성

```bash
target_include_directories(target_name [PUBLIC|PRIVATE|INTERFACE] path)
```

- target_name 을 생성할 때 사용할 include path 설정

```bash
target_link_directories(target_name [PUBLIC|PRIVATE|INTERFACE] path)
```

- target_name 을 생성할 때 library 등이 있는 경로를 설정

```bash
target_link_libraries(target_name [PUBLIC|PRIVATE|INTERFACE] library1 [library2])
```

- link 할 라이브러리들을 설정

```bash
set_target_properties(target_name PROPERTIES prop1 value1)
```

- target_name 을 생성할때의 옵션들을 지정
- 생성 경로 등의 옵션을 지정

```bash
add_dependencies(target_name dep_name1 [dep_name2])
```

- target_name 을 만들기 위해 필요한 의존성 주입

```bash
target_compile_definitions(target_name
	[PUBLIC|PRIVATE|INTERFACE] DEFINE_NAME=VALUE)
```

- target_name 을 생성할 때 넣어줄 define 값을 설정

### file

```bash
file()
```

- READ, WRITE, STRING, GLOB, COPY 등등 file 처리와 관련된 작업

### include

```bash
include(file_name)
```

- 외부 파일 사용
- CMakeLists.txt 파일의 분할

### ExternalProject

```bash
include(ExternalProject)
```

- build time 에서 진행
- ExternalProject 모듈 사용
- 외부 프로젝트, 라이브러리를 사용할 때 외부 주소를 이용해 다운로드, 클론 등의 작업을 담당

```bash
ExternalProject_Add(name [options...])
```

- 외부 프로젝트의 다운로드
- 옵션
    - GIT_REPOSITORY
    - GIT_TAG
    - GIT_SHALLOW
    - UPDATE_COMMAND
    - PATCH_COMMAND
    - TEST_COMMAND
    - BUILD_COMMAND
    - CMAKE_ARGS
    - …

### FetchContent

```bash
include(FetchContent)
```

- configure time 에서 진행
- FetchContent 모듈 사용
- ExternalProject 처럼 외부 프로젝트를 불러올 때 사용하며 configure 시간에 진행되어 build 시 필요한 repo 를 미리 받아올 필요가 있을 때 등등의 경우 사용

```bash
FetchContent_Declare(name [options...])
```

- 외부 프로젝트의 다운로드
- 옵션
    - GIT_REPOSITORY
    - GIT_TAG

```bash
FetchContent_MakeAvailable(name1 [name2...])
```

- FetchContent_Declare 로 선언된 fetch 를 허용한다는 명시
- cmake 과정에서 한번만 진행되며 이전에 name 들이 FetchContent_Declare 로 선언되어 있어야 함
- FetchContent_MakeAvailable 로 명시되지 않은 name 은 다운로드 과정을 진행하지 않음