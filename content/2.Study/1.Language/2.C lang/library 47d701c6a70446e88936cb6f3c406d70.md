# library

**정적 라이브러리**

- 오브젝트 파일의 모음, 컴파일 할 때 실행 파일에 라이브러리를 포함 시켜서 넣는다

**공유 라이브러리**

- 프로그램이 실행 될 때 라이브러리를 불러온다, 실행프로그램의 크기는 동적 라이브러리 보다 작으나 라이브러리를 불러오는 과정이 필요해진다

**동적 라이브러리**

- 실행 중 특정 상황에 라이브러리를 불러온다

**정적 라이브러리 생성방법**

- .a 의 확장자를 가진다
- gcc 명령어를 사용해 오브젝트 파일 생성
    - 컴파일 시 사용 옵션
    - c : 컴파일 후 오브젝트 파일만 만든 후 링크 하지 않기
    - I : 대문자 i, 연결되는 헤더가 들어있는 디렉토리의 경로를 기입
- ar 명령어를 사용해 라이브러리를 생성
- ar {option} {library name} {object file name}
- 라이브러리 파일의 이름은 libNAME.a 를 따른다
    - option
        - 라이브러리 생성, 갱신
            - r : 추가되는 오브젝트 파일이 존재하지 않다면 추가, 이미 존재하는 상태이면 치환한다
            - c : 라이브러리 파일 생성, 존재하지 않는 파일을 새로 생성할 때에도 경고를 하지 않는다
            - s : 라이브러리에 인덱스를 추가한다
            - u : 변경되는 오브젝트 파일의 타임스템프를 비교해 새로운 파일일 경우에만 치환
        - 라이브러리 수정, 삭제
            - d : 라이브러리에서 뒤에오는 오브젝트 파일이 존재하면 삭제, 없으면 동작하지 않음
        - 라이브러리 조회
            - t : 라이브러리에 있는 파일들의 리스트를 출력
            - v : verbose 모드, 상세보기 기능
        - 라이브러리 내의 파일 추출
            - x : 라이브러리 내에 있는 오브젝트파일들 추출
            - v : 추출한 파일들의 파일명 출력

**공유 라이브러리 생성방법**

- .so 의 확장자를 가진다
- gcc 명령어를 사용해 오브젝트 파일 생성
    - 컴파일 시 사용 옵션
    - c : 컴파일 후 오브젝트 파일만 만든 후 링크 하지 않기
    - I : 대문자 i, 연결되는 헤더가 들어있는 디렉토리의 경로를 기입
    - fpic, -fPIC : 공유 라이브러리에 필요한 옵션인 ‘위치 독립 코드’ 를 생성해주는 옵션, 대문자 옵션은 거의 모든상황에서 작동하나 코드가 더 커지게 되고 소문자 옵션은 작고 빠르지만 플랫폼에 종속될 수 있다
        - 함수들이 컴파일 시에 저장되는게 아닌 실행 시 메모리에 저장되기 때문에 절대 주소가 아닌 상대주소(offset) 을 사용하도록 한다…라고 설명이 되어있다
- gcc 의 다른 옵션을 사용 해 라이브러리 파일 생성
- gcc -shared -o {library name} {object file name}
- 라이브러리 이름은 libNAME.so 를 따른다
    - 컴파일 시 사용 옵션
    - shared : 공유 라이브러리를 생성하는 옵션
    - rdynamic : -W1 -export-dynamic 과 동일, 링커가 dynamic symbol table 에 symbol, 즉 함수이름들을 추가하도록 한다, 사용하지 않아도 문제 없다고 한다…..?

**동적 라이브러리 생성방법**

- 동적 라이브러리의 생성방법은 공유 라이브러리의 생성방법과 같다
- 라이브러리를 생성하는 과정이 아닌 라이브러리를 사용하는 코드에서 추가로 코드를 넣어주어야한다
    - 라이브러리를 사용하는 코드에서 dlfcn.h 헤더에 있는 함수들을 사용해 코드 내에서 라이브러리를 필요한 시점에 불러 사용한다
    - dlopen : 라이브러리를 연다
    - dlerror : dl 관련 함수가 제대로 작동하지 않은 경우 에러메세지를 반환한다
    - dlsym : 라이브러리에서 심볼값, 즉 함수를 불러온다, 반환값은 해당함수를 가리키는 보이드 포인터이다
    - dlclose : 사용중인 라이브러리를 닫는다

**라이브러리 사용방법**

- 컴파일 시 옵션 사용
    - L : 뒤에 띄어쓰기 유무 상관 없음, 사용 할 라이브러리 파일의 경로를 지정
    - l : 소문자 L, 띄어쓰기 유무 상관 없음, 사용할 라이브러리의 이름을 지정, libft.a 라는 라이브러리를 사용 시 -lft 처럼 lib 와 .a 를 때고 작성